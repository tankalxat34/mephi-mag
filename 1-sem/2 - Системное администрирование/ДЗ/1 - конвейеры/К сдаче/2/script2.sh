#!/bin/bash
# Часть 2. Задание 2.
# Напишите Bash-скрипт для анализа лог-файлов в указанной директории. 
# Скрипт должен найти все файлы с расширением «.log» в указанной директории 
# (директория передается в параметрах скрипта) и подсчитать количество строк, 
# содержащих определенное ключевое слово (например, «ERROR» или «Exception»). 
# Ключевое слово должно быть задано в переменной в начале скрипта. Скрипт должен 
# выводить сообщение в формате: 
# «Файл [ИМЯ ФАЙЛА] содержит [КОЛИЧЕСТВО СТРОК С КЛЮЧЕВЫМ СЛОВОМ] строк с ключевым словом [КЛЮЧЕВОЕ СЛОВО]». 
# В конце скрипта выведите общее количество строк с ключевым словом по всем лог-файлам в данной директории.

# Проверка: передана ли директория
if [ $# -eq 0 ]; then
    echo "Ошибка: не указана директория." >&2
    echo "Использование: $0 /путь/к/директории" >&2
    exit 1
fi

LOG_DIR="$1"

# Проверка: существует ли директория
if [ ! -d "$LOG_DIR" ]; then
    echo "Ошибка: директория '$LOG_DIR' не существует или не является директорией." >&2
    exit 1
fi

# Ключевое слово (можно менять)
KEYWORD="ERROR"

# Счётчик общего количества строк
total_count=0

echo "Анализ лог-файлов в директории: $LOG_DIR"
echo "Ключевое слово: '$KEYWORD'"
echo "----------------------------------------"

# Находим все .log файлы и обрабатываем по одному
while IFS= read -r -d '' logfile; do
    # Подсчитываем количество строк с ключевым словом
    count=$(grep -c "$KEYWORD" "$logfile" 2>/dev/null || echo 0)

    # Выводим результат для файла
    echo "Файл $(basename "$logfile") содержит $count строк с ключевым словом '$KEYWORD'"

    # Добавляем к общему счётчику
    ((total_count += count))

done < <(find "$LOG_DIR" -type f -name "*.log" -print0)

# Выводим итог
echo "----------------------------------------"
echo "Общее количество строк с ключевым словом '$KEYWORD': $total_count"